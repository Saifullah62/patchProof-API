{"numFailedTestSuites":2,"numFailedTests":6,"numPassedTestSuites":0,"numPassedTests":4,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":1,"numTodoTests":0,"numTotalTestSuites":2,"numTotalTests":10,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1754794723558,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["Key Derivation"],"duration":240,"failureDetails":[{}],"failureMessages":["TypeError: k1.toWIF is not a function\n    at Object.toWIF (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\keyUtils.test.js:22:15)\n    at Promise.then.completed (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Key Derivation should deterministically derive the same key for same input","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should deterministically derive the same key for same input"},{"ancestorTitles":["Key Derivation"],"duration":201,"failureDetails":[{}],"failureMessages":["TypeError: k1.toWIF is not a function\n    at Object.toWIF (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\keyUtils.test.js:27:15)\n    at Promise.then.completed (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Key Derivation should derive different keys for different messages","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should derive different keys for different messages"},{"ancestorTitles":["Key Derivation"],"duration":196,"failureDetails":[{}],"failureMessages":["TypeError: k1.toWIF is not a function\n    at Object.toWIF (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\keyUtils.test.js:33:15)\n    at Promise.then.completed (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Key Derivation should derive ephemeral keys with entropy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should derive ephemeral keys with entropy"},{"ancestorTitles":["Key Derivation"],"duration":301,"failureDetails":[{}],"failureMessages":["TypeError: tree.auth.toWIF is not a function\n    at Object.toWIF (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\keyUtils.test.js:37:22)\n    at Promise.then.completed (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Key Derivation should derive a key tree with unique subkeys","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should derive a key tree with unique subkeys"},{"ancestorTitles":["Signing and Verification"],"duration":100,"failureDetails":[{}],"failureMessages":["Error: hashBuf must be a 32 byte buffer\n    at X.sign (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\bsv\\dist\\webpack:\\bsv\\lib\\ecdsa.js:363:13)\n    at Function.sign (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\bsv\\dist\\webpack:\\bsv\\lib\\ecdsa.js:459:8)\n    at sign (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\keyUtils.js:166:20)\n    at Object.signHash (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\keyUtils.test.js:47:17)\n    at Promise.then.completed (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Signing and Verification should sign and verify a hash","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should sign and verify a hash"},{"ancestorTitles":["Signing and Verification"],"duration":102,"failureDetails":[{}],"failureMessages":["Error: hashBuf must be a 32 byte buffer\n    at X.sign (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\bsv\\dist\\webpack:\\bsv\\lib\\ecdsa.js:363:13)\n    at Function.sign (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\bsv\\dist\\webpack:\\bsv\\lib\\ecdsa.js:459:8)\n    at sign (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\keyUtils.js:166:20)\n    at Object.signHash (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\keyUtils.test.js:54:17)\n    at Promise.then.completed (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Signing and Verification should fail verification for tampered hash","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should fail verification for tampered hash"},{"ancestorTitles":["Object Hashing"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Object Hashing should produce same hash for objects with same content (canonical)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should produce same hash for objects with same content (canonical)"},{"ancestorTitles":["Object Hashing"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Object Hashing should produce different hashes for different objects","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should produce different hashes for different objects"},{"ancestorTitles":["Merkle Root"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Merkle Root should compute correct Merkle root for two hashes","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should compute correct Merkle root for two hashes"},{"ancestorTitles":["Merkle Root"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Merkle Root should compute correct Merkle root for empty array","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should compute correct Merkle root for empty array"}],"endTime":1754794725168,"message":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mKey Derivation › should deterministically derive the same key for same input\u001b[39m\u001b[22m\n\n    TypeError: k1.toWIF is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 20 |\u001b[39m     \u001b[36mconst\u001b[39m k1 \u001b[33m=\u001b[39m deriveKeyFromMessage(\u001b[32m'user@example.com'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m k2 \u001b[33m=\u001b[39m deriveKeyFromMessage(\u001b[32m'user@example.com'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 22 |\u001b[39m     expect(k1\u001b[33m.\u001b[39mtoWIF())\u001b[33m.\u001b[39mtoBe(k2\u001b[33m.\u001b[39mtoWIF())\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m   it(\u001b[32m'should derive different keys for different messages'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m k1 \u001b[33m=\u001b[39m deriveKeyFromMessage(\u001b[32m'userA@example.com'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toWIF (\u001b[22m\u001b[2m\u001b[0m\u001b[36mtests/keyUtils.test.js\u001b[39m\u001b[0m\u001b[2m:22:15)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mKey Derivation › should derive different keys for different messages\u001b[39m\u001b[22m\n\n    TypeError: k1.toWIF is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m k1 \u001b[33m=\u001b[39m deriveKeyFromMessage(\u001b[32m'userA@example.com'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 26 |\u001b[39m     \u001b[36mconst\u001b[39m k2 \u001b[33m=\u001b[39m deriveKeyFromMessage(\u001b[32m'userB@example.com'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 27 |\u001b[39m     expect(k1\u001b[33m.\u001b[39mtoWIF())\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoBe(k2\u001b[33m.\u001b[39mtoWIF())\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 28 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m   it(\u001b[32m'should derive ephemeral keys with entropy'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 30 |\u001b[39m     \u001b[36mconst\u001b[39m k1 \u001b[33m=\u001b[39m deriveEphemeralSessionKey(\u001b[32m'user@example.com'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'login'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toWIF (\u001b[22m\u001b[2m\u001b[0m\u001b[36mtests/keyUtils.test.js\u001b[39m\u001b[0m\u001b[2m:27:15)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mKey Derivation › should derive ephemeral keys with entropy\u001b[39m\u001b[22m\n\n    TypeError: k1.toWIF is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 31 |\u001b[39m     \u001b[36mconst\u001b[39m k2 \u001b[33m=\u001b[39m deriveEphemeralSessionKey(\u001b[32m'user@example.com'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'login'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m     \u001b[90m// Should be different due to timestamp entropy\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 33 |\u001b[39m     expect(k1\u001b[33m.\u001b[39mtoWIF())\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoBe(k2\u001b[33m.\u001b[39mtoWIF())\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m   it(\u001b[32m'should derive a key tree with unique subkeys'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m     \u001b[36mconst\u001b[39m tree \u001b[33m=\u001b[39m deriveKeyTree(\u001b[32m'user-abc'\u001b[39m\u001b[33m,\u001b[39m [\u001b[32m'auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'transfer'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'encryption'\u001b[39m])\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toWIF (\u001b[22m\u001b[2m\u001b[0m\u001b[36mtests/keyUtils.test.js\u001b[39m\u001b[0m\u001b[2m:33:15)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mKey Derivation › should derive a key tree with unique subkeys\u001b[39m\u001b[22m\n\n    TypeError: tree.auth.toWIF is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 35 |\u001b[39m   it(\u001b[32m'should derive a key tree with unique subkeys'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m     \u001b[36mconst\u001b[39m tree \u001b[33m=\u001b[39m deriveKeyTree(\u001b[32m'user-abc'\u001b[39m\u001b[33m,\u001b[39m [\u001b[32m'auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'transfer'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'encryption'\u001b[39m])\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 37 |\u001b[39m     expect(tree\u001b[33m.\u001b[39mauth\u001b[33m.\u001b[39mtoWIF())\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoBe(tree\u001b[33m.\u001b[39mtransfer\u001b[33m.\u001b[39mtoWIF())\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m     expect(tree\u001b[33m.\u001b[39mtransfer\u001b[33m.\u001b[39mtoWIF())\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoBe(tree\u001b[33m.\u001b[39mencryption\u001b[33m.\u001b[39mtoWIF())\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 40 |\u001b[39m })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toWIF (\u001b[22m\u001b[2m\u001b[0m\u001b[36mtests/keyUtils.test.js\u001b[39m\u001b[0m\u001b[2m:37:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mSigning and Verification › should sign and verify a hash\u001b[39m\u001b[22m\n\n    hashBuf must be a 32 byte buffer\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 164 |\u001b[39m \u001b[90m */\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 165 |\u001b[39m \u001b[36mfunction\u001b[39m signHash(hash\u001b[33m,\u001b[39m keyPair) {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 166 |\u001b[39m   \u001b[36mreturn\u001b[39m bsv\u001b[33m.\u001b[39m\u001b[33mEcdsa\u001b[39m\u001b[33m.\u001b[39msign(hash\u001b[33m,\u001b[39m keyPair)\u001b[33m.\u001b[39mtoString()\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 167 |\u001b[39m }\u001b[22m\n\u001b[2m     \u001b[90m 168 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 169 |\u001b[39m \u001b[90m/**\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat X.sign (\u001b[22m\u001b[2mnode_modules/bsv/dist/webpack:/bsv/lib/ecdsa.js\u001b[2m:363:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Function.sign (\u001b[22m\u001b[2mnode_modules/bsv/dist/webpack:/bsv/lib/ecdsa.js\u001b[2m:459:8)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat sign (\u001b[22m\u001b[2mkeyUtils.js\u001b[2m:166:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.signHash (\u001b[22m\u001b[2m\u001b[0m\u001b[36mtests/keyUtils.test.js\u001b[39m\u001b[0m\u001b[2m:47:17)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mSigning and Verification › should fail verification for tampered hash\u001b[39m\u001b[22m\n\n    hashBuf must be a 32 byte buffer\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 164 |\u001b[39m \u001b[90m */\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 165 |\u001b[39m \u001b[36mfunction\u001b[39m signHash(hash\u001b[33m,\u001b[39m keyPair) {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 166 |\u001b[39m   \u001b[36mreturn\u001b[39m bsv\u001b[33m.\u001b[39m\u001b[33mEcdsa\u001b[39m\u001b[33m.\u001b[39msign(hash\u001b[33m,\u001b[39m keyPair)\u001b[33m.\u001b[39mtoString()\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 167 |\u001b[39m }\u001b[22m\n\u001b[2m     \u001b[90m 168 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 169 |\u001b[39m \u001b[90m/**\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat X.sign (\u001b[22m\u001b[2mnode_modules/bsv/dist/webpack:/bsv/lib/ecdsa.js\u001b[2m:363:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Function.sign (\u001b[22m\u001b[2mnode_modules/bsv/dist/webpack:/bsv/lib/ecdsa.js\u001b[2m:459:8)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat sign (\u001b[22m\u001b[2mkeyUtils.js\u001b[2m:166:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.signHash (\u001b[22m\u001b[2m\u001b[0m\u001b[36mtests/keyUtils.test.js\u001b[39m\u001b[0m\u001b[2m:54:17)\u001b[22m\u001b[2m\u001b[22m\n","name":"C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\keyUtils.test.js","startTime":1754794723618,"status":"failed","summary":""},{"assertionResults":[],"coverage":{},"endTime":1754794725421,"message":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[1m\u001b[31mJest encountered an unexpected token\u001b[39m\u001b[22m\n\n    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.\n\n    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.\n\n    By default \"node_modules\" folder is ignored by transformers.\n\n    Here's what you can do:\n     • If you are trying to use ECMAScript Modules, see \u001b[4mhttps://jestjs.io/docs/ecmascript-modules\u001b[24m for how to enable it.\n     • If you are trying to use TypeScript, see \u001b[4mhttps://jestjs.io/docs/getting-started#using-typescript\u001b[24m\n     • To have some of your \"node_modules\" files transformed, you can specify a custom \u001b[1m\"transformIgnorePatterns\"\u001b[22m in your config.\n     • If you need a custom transformation specify a \u001b[1m\"transform\"\u001b[22m option in your config.\n     • If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the \u001b[1m\"moduleNameMapper\"\u001b[22m config option.\n\n    You'll find more details and examples of these config options in the docs:\n    \u001b[36mhttps://jestjs.io/docs/configuration\u001b[39m\n    For information about custom transformations, see:\n    \u001b[36mhttps://jestjs.io/docs/code-transformation\u001b[39m\n\n    \u001b[1m\u001b[31mDetails:\u001b[39m\u001b[22m\n\n    SyntaxError: C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\api.integration.test.js: Identifier 'request' has already been declared. (69:6)\n\n    \u001b[0m \u001b[90m 67 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 68 |\u001b[39m \u001b[90m// Integration tests for PatchProof Auth API\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 69 |\u001b[39m \u001b[36mconst\u001b[39m request \u001b[33m=\u001b[39m require(\u001b[32m'supertest'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 70 |\u001b[39m \u001b[36mconst\u001b[39m app \u001b[33m=\u001b[39m require(\u001b[32m'../auth_api_production'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 71 |\u001b[39m \u001b[36mconst\u001b[39m { initDb\u001b[33m,\u001b[39m getCodeDb\u001b[33m,\u001b[39m closeDb } \u001b[33m=\u001b[39m require(\u001b[32m'../db'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 72 |\u001b[39m\u001b[0m\n\n      \u001b[2mat constructor (\u001b[22mnode_modules/@babel/parser/src/parse-error.ts\u001b[2m:95:45)\u001b[22m\n      \u001b[2mat Parser.toParseError [as raise] (\u001b[22mnode_modules/@babel/parser/src/tokenizer/index.ts\u001b[2m:1503:19)\u001b[22m\n      \u001b[2mat ScopeHandler.raise [as checkRedeclarationInScope] (\u001b[22mnode_modules/@babel/parser/src/util/scope.ts\u001b[2m:164:19)\u001b[22m\n      \u001b[2mat ScopeHandler.checkRedeclarationInScope [as declareName] (\u001b[22mnode_modules/@babel/parser/src/util/scope.ts\u001b[2m:118:12)\u001b[22m\n      \u001b[2mat Parser.declareName [as declareNameFromIdentifier] (\u001b[22mnode_modules/@babel/parser/src/parser/lval.ts\u001b[2m:818:16)\u001b[22m\n      \u001b[2mat Parser.declareNameFromIdentifier [as checkIdentifier] (\u001b[22mnode_modules/@babel/parser/src/parser/lval.ts\u001b[2m:813:12)\u001b[22m\n      \u001b[2mat Parser.checkIdentifier [as checkLVal] (\u001b[22mnode_modules/@babel/parser/src/parser/lval.ts\u001b[2m:713:12)\u001b[22m\n      \u001b[2mat Parser.checkLVal [as parseVarId] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:1628:10)\u001b[22m\n      \u001b[2mat Parser.parseVarId [as parseVar] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:1577:12)\u001b[22m\n      \u001b[2mat Parser.parseVar [as parseVarStatement] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:1246:10)\u001b[22m\n      \u001b[2mat Parser.parseVarStatement [as parseStatementContent] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:607:21)\u001b[22m\n      \u001b[2mat Parser.parseStatementContent [as parseStatementLike] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:477:17)\u001b[22m\n      \u001b[2mat Parser.parseStatementLike [as parseModuleItem] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:414:17)\u001b[22m\n      \u001b[2mat Parser.parseModuleItem [as parseBlockOrModuleBlockBody] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:1438:16)\u001b[22m\n      \u001b[2mat Parser.parseBlockOrModuleBlockBody [as parseBlockBody] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:1412:10)\u001b[22m\n      \u001b[2mat Parser.parseBlockBody [as parseProgram] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:229:10)\u001b[22m\n      \u001b[2mat Parser.parseProgram [as parseTopLevel] (\u001b[22mnode_modules/@babel/parser/src/parser/statement.ts\u001b[2m:203:25)\u001b[22m\n      \u001b[2mat Parser.parseTopLevel [as parse] (\u001b[22mnode_modules/@babel/parser/src/parser/index.ts\u001b[2m:93:10)\u001b[22m\n      \u001b[2mat parse (\u001b[22mnode_modules/@babel/parser/src/index.ts\u001b[2m:92:38)\u001b[22m\n      \u001b[2mat parser (\u001b[22mnode_modules/@babel/core/src/parser/index.ts\u001b[2m:28:19)\u001b[22m\n          at parser.next (<anonymous>)\n      \u001b[2mat normalizeFile (\u001b[22mnode_modules/@babel/core/src/transformation/normalize-file.ts\u001b[2m:49:24)\u001b[22m\n          at normalizeFile.next (<anonymous>)\n      \u001b[2mat run (\u001b[22mnode_modules/@babel/core/src/transformation/index.ts\u001b[2m:40:36)\u001b[22m\n          at run.next (<anonymous>)\n      \u001b[2mat transform (\u001b[22mnode_modules/@babel/core/src/transform.ts\u001b[2m:29:20)\u001b[22m\n          at transform.next (<anonymous>)\n      \u001b[2mat evaluateSync (\u001b[22mnode_modules/gensync/index.js\u001b[2m:251:28)\u001b[22m\n      \u001b[2mat sync (\u001b[22mnode_modules/gensync/index.js\u001b[2m:89:14)\u001b[22m\n      \u001b[2mat fn (\u001b[22mnode_modules/@babel/core/src/errors/rewrite-stack-trace.ts\u001b[2m:99:14)\u001b[22m\n      \u001b[2mat transformSync (\u001b[22mnode_modules/@babel/core/src/transform.ts\u001b[2m:66:52)\u001b[22m\n      \u001b[2mat ScriptTransformer.transformSource (\u001b[22mnode_modules/@jest/transform/build/ScriptTransformer.js\u001b[2m:545:31)\u001b[22m\n      \u001b[2mat ScriptTransformer._transformAndBuildScript (\u001b[22mnode_modules/@jest/transform/build/ScriptTransformer.js\u001b[2m:674:40)\u001b[22m\n      \u001b[2mat ScriptTransformer.transform (\u001b[22mnode_modules/@jest/transform/build/ScriptTransformer.js\u001b[2m:726:19)\u001b[22m\n","name":"C:\\Users\\bryan\\Downloads\\patchproof_api_prod\\tests\\api.integration.test.js","startTime":1754794725421,"status":"failed","summary":""}],"wasInterrupted":false}
